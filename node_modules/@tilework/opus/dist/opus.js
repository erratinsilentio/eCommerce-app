!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("tslib")):"function"==typeof define&&define.amd?define(["exports","tslib"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Opus={},e.tslib)}(this,(function(e,t){"use strict";var n,r=function(){function e(){var e=this;this.fields=[],this.getFields=function(){return e.fields}}return e.prototype.add=function(e){if(this.type){if(this.type!==e.type)throw new Error("Cannot combine queries and mutations together!")}else this.type=e.type;return this.fields.push(e),this},e}();e.GraphQlRequestType=void 0,(n=e.GraphQlRequestType||(e.GraphQlRequestType={})).Mutation="mutation",n.Query="query";var i=function(e,n){void 0===n&&(n={});var r=e.alias,s=e.name,a=e.args,o=e.children,u=a.reduce((function(e,r){var i=r.name,s=r.type,a=r.value;n[i]||(n[i]=[]);var o=n[i].push([s,a]);return t.__spreadArray(t.__spreadArray([],e),[i+":$"+i+"_"+o])}),[]),c=u.length?"("+u.join(",")+")":"",l=o.map((function(e){return i(e,n)})).join(",");return""+r+s+c+(o.length?"{"+l+"}":"")},s=function(e,t){var n=Array.isArray(e)?e:[e],r={},s={},a=n.map((function(e){return i(e,s)})).join(","),o=Object.entries(s).reduce((function(e,t){var n=t[0];return t[1].forEach((function(t,i){var s=t[0],a=t[1],o=n+"_"+(i+1);e.push("$"+o+":"+s),r[o]=a})),e}),[]);return{query:""+t+(o.length?"("+o.join(",")+")":"")+"{"+a+"}",variables:r}},a=function(e){var t=e.errors,n=e.data;if(t)throw t;return n},o=function(e){return"string"==typeof e?e:Array.isArray(e)?e[0].message:e.message?e.message:"Something went wrong"},u=function(e){try{return a(e)}catch(e){throw new Error(o(e))}},c="undefined"==typeof window?require("node-fetch"):window.fetch,l=function(e,n){var r=n.headers,i=void 0===r?{}:r;return t.__assign(t.__assign({},e),i)},p=function(e,n,r){return c(r.endpoint,t.__assign(t.__assign({},r),{method:"POST",body:JSON.stringify({query:e,variables:n}),headers:l({"Content-Type":"application/json",Accept:"application/json"},r)}))},h=function(e,t){var n=e.query,r=e.variables;return p(n,r,t)},f=function(e,t){if("object"==typeof t)for(var n in e(t),t)f(e,t[n])},d={endpoint:process.env.GRAPHQL_ENDPOINT||"/graphql"},y=function(){function e(){var e=this;this.options=d,this.setEndpoint=function(t){e.options.endpoint=t},this.setHeaders=function(t){e.options.headers=t},this.getOptions=function(){return e.options}}return e.prototype.post=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){var i,a,o,c,l,p,d;return t.__generator(this,(function(y){switch(y.label){case 0:if(!(i=e instanceof r?e.getFields():[e]).length)throw new Error("Attempting to post empty field!");return[4,h(s(i,e.type),t.__assign(t.__assign({},this.options),n||{}))];case 1:return a=y.sent(),c=u,[4,a.json()];case 2:if(o=c.apply(void 0,[y.sent()]),!(e instanceof r))return[3,7];l=0,p=e.getFields(),y.label=3;case 3:return l<p.length?(d=p[l],[4,this.process(d,o[d.name],o)]):[3,6];case 4:y.sent(),y.label=5;case 5:return l++,[3,3];case 6:return[3,9];case 7:return[4,this.process(e,o[e.name],o)];case 8:y.sent(),y.label=9;case 9:return f(Object.freeze,o),[2,o]}}))}))},e.prototype.process=function(e,n,r){return t.__awaiter(this,void 0,void 0,(function(){var i,s,a,o,u,c,l,p,h,d,y,g,b,v,_,m,w,F;return t.__generator(this,(function(t){switch(t.label){case 0:if(!e.children.length)return[2];if(!Array.isArray(n))return[3,5];i=0,s=n,t.label=1;case 1:return i<s.length?(a=s[i],[4,this.process(e,a,r)]):[3,4];case 2:t.sent(),t.label=3;case 3:return i++,[3,1];case 4:return[3,20];case 5:o=0,u=e.children,t.label=6;case 6:if(!(o<u.length))return[3,14];if("InlineFragment"!==(c=u[o]).tag)return[3,11];l=0,p=c.children,t.label=7;case 7:return l<p.length?(h=p[l],null!==n&&Object.hasOwnProperty.call(n,h.name)?[4,this.process(h,n[h.name],n)]:[3,9]):[3,10];case 8:t.sent(),t.label=9;case 9:return l++,[3,7];case 10:return[3,13];case 11:return null!==n&&Object.hasOwnProperty.call(n,c.name)?[4,this.process(c,n[c.name],n)]:[3,13];case 12:t.sent(),t.label=13;case 13:return o++,[3,6];case 14:d=0,y=Object.entries(e.calculators),t.label=15;case 15:return d<y.length?(g=y[d],b=g[0],v=g[1],_=n,m=b,[4,v(n)]):[3,18];case 16:_[m]=t.sent(),t.label=17;case 17:return d++,[3,15];case 18:return f(Object.seal,n),e.transformer?(w=r,F=e.name,[4,e.transformer(n)]):[3,20];case 19:w[F]=t.sent(),t.label=20;case 20:return[2]}}))}))},e}(),g=function(){function e(e,t){this.tag="AbstractField",this.alias="",this.children=[],this.args=[],this.resultTypeHolder={},this.calculators={},this.name=e,this.isArray=t}return e.prototype.setAlias=function(e){return this.alias=e+":",this},e.prototype.addArgument=function(e,t,n){return void 0===n||this.args.push({name:e,type:t,value:n}),this},e.prototype.addCalculatedField=function(e,t){return this.calculators[e]=t,this},e.prototype.addTransformation=function(e){return this.transformer=e,this},e.prototype.addField=function(e){if("string"==typeof e)this.children.push(new b(e));else{if(!(e instanceof b||(t=e,"object"==typeof t&&t.tag&&"InlineFragment"===t.tag)))throw new Error("Unknown field type!");this.children.push(e)}var t;return this},e.prototype.addFieldList=function(e){return e.forEach(this.addField.bind(this)),this},e}(),b=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="Field",t}return t.__extends(n,e),n}(g),v=function(e){function n(t){var n=e.call(this,"... on "+t)||this;return n.tag="InlineFragment",n}return t.__extends(n,e),n}(g),_=function(n){function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.tag="Mutation",t.type=e.GraphQlRequestType.Mutation,t}return t.__extends(r,n),r}(g),m=function(n){function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.tag="Query",t.type=e.GraphQlRequestType.Query,t}return t.__extends(r,n),r}(g),w=new y;e.AbstractField=g,e.Client=y,e.CombinedField=r,e.Field=b,e.InlineFragment=v,e.Mutation=_,e.Query=m,e.checkForErrors=a,e.client=w,e.deepApply=f,e.defaultOptions=d,e.executePost=h,e.parseError=o,e.parseResponse=u,e.postFetch=p,e.prepareFieldString=i,e.prepareRequest=s,e.processHeaders=l,Object.defineProperty(e,"__esModule",{value:!0})}));
